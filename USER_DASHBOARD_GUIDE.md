# راهنمای پیکربندی داشبورد کاربران و احراز هویت با ملی پیامک

## مقدمه
این راهنما به شما کمک می‌کند تا سیستم داشبورد کاربران و احراز هویت مبتنی بر OTP (رمز یکبار مصرف) را با استفاده از سرویس ملی پیامک پیکربندی کنید.

## قدم اول: دریافت اطلاعات از پنل ملی پیامک

### 1. ورود به پنل ملی پیامک
- به وب‌سایت [ملی پیامک](https://panel.melipayamak.ir) مراجعه کنید
- با نام کاربری و رمز عبور خود وارد شوید

### 2. دریافت نام کاربری و رمز عبور Webservice
این اطلاعات برای ارتباط با API ملی پیامک نیاز است:
- نام کاربری: همان نام کاربری پنل شما
- رمز عبور: همان رمز عبور پنل شما

### 3. دریافت شماره فرستنده (Base Number)
- شماره خط ارسال پیامک که معمولاً 10 رقمی است
- این شماره در بخش "خطوط من" قابل مشاهده است
- مثال: `1000596446`

### 4. ایجاد پترن (Pattern) برای OTP
پترن یک الگوی از پیش تعریف شده برای پیامک است که به جای متن آزاد استفاده می‌شود.

#### مراحل ایجاد پترن:
1. در پنل ملی پیامک به بخش **"ارسال گروهی" > "مدیریت پترن"** بروید
2. روی **"ایجاد پترن جدید"** کلیک کنید
3. متن پترن خود را وارد کنید، مثال:
   ```
   کد تأیید شما: %code%
   ```
4. پترن را ثبت کنید
5. **کد پترن (BodyId)** به شما داده می‌شود - این عدد را یادداشت کنید
   - مثال: `12345`

#### نکات مهم در ایجاد پترن:
- از متغیرهایی مانند `%code%` برای قرار دادن کد OTP استفاده کنید
- متن باید کوتاه و واضح باشد
- پترن باید توسط ملی پیامک تأیید شود (معمولاً طی چند ساعت)

## قدم دوم: پیکربندی افزونه

### 1. ورود به پنل مدیریت وردپرس
- به مسیر `/wp-admin` بروید
- وارد حساب مدیر شوید

### 2. باز کردن تنظیمات داشبورد کاربران
- در منوی سمت چپ، گزینه **"Tabesh v2"** را پیدا کنید
- روی **"داشبورد کاربران"** کلیک کنید

### 3. فعال‌سازی داشبورد
- چک‌باکس **"فعال‌سازی داشبورد کاربران"** را فعال کنید
- در فیلد **"آدرس صفحه (Slug)"** یک نام برای صفحه انتخاب کنید
  - پیشنهاد: `panel` یا `dashboard`
  - این نام در URL ظاهر می‌شود: `https://yoursite.com/panel`

### 4. ایجاد صفحه داشبورد
- روی دکمه **"ایجاد/باز سازی صفحه"** کلیک کنید
- صفحه داشبورد به صورت خودکار ایجاد می‌شود
- آدرس صفحه به شما نمایش داده می‌شود

### 5. تنظیمات احراز هویت OTP
- چک‌باکس **"فعال‌سازی ورود/ثبت‌نام با OTP"** را فعال کنید
- **طول کد OTP**: 5 (پیشنهادی)
- **زمان انقضا**: 120 ثانیه (2 دقیقه)
- گزینه‌های اضافی:
  - ✅ درخواست نام و نام خانوادگی در ثبت‌نام
  - ✅ امکان ثبت‌نام شخص حقوقی

### 6. تنظیمات ملی پیامک
در بخش **"تنظیمات ملی پیامک"** اطلاعات زیر را وارد کنید:

- **نام کاربری پنل ملی پیامک**: نام کاربری که از قدم اول دریافت کردید
- **رمز عبور پنل ملی پیامک**: رمز عبور که از قدم اول دریافت کردید
- **شماره فرستنده**: شماره 10 رقمی خط ارسال
- **کد پترن**: عدد BodyId که هنگام ایجاد پترن دریافت کردید

### 7. تست اتصال
- در فیلد **"تست اتصال"** شماره موبایل خود را وارد کنید (مثال: `09123456789`)
- روی دکمه **"ارسال پیامک آزمایشی"** کلیک کنید
- اگر همه چیز درست باشد، کد OTP به شماره شما ارسال می‌شود

### 8. ذخیره تنظیمات
- روی دکمه **"ذخیره تنظیمات"** کلیک کنید

## قدم سوم: استفاده از سیستم

### برای کاربران:
1. کاربران به صفحه داشبورد می‌روند (مثلاً `https://yoursite.com/panel`)
2. شماره موبایل خود را وارد می‌کنند
3. کد تأیید برایشان پیامک می‌شود
4. کد را وارد می‌کنند
5. در صورت ثبت‌نام اولیه، نام و نام خانوادگی را وارد می‌کنند
6. وارد داشبورد می‌شوند

### برای مدیر:
- می‌توانید ترتیب منوهای داشبورد را تغییر دهید
- می‌توانید برخی منوها را فعال یا غیرفعال کنید
- می‌توانید صفحه داشبورد را در صورت نیاز بازسازی کنید

## رفع مشکلات رایج

### پیامک ارسال نمی‌شود
- بررسی کنید که اعتبار پنل ملی پیامک کافی باشد
- مطمئن شوید که پترن توسط ملی پیامک تأیید شده است
- نام کاربری و رمز عبور را دوباره بررسی کنید
- شماره فرستنده را صحیح وارد کرده باشید

### کد تأیید منقضی می‌شود
- زمان انقضا را افزایش دهید (مثلاً از 120 به 180 ثانیه)

### صفحه داشبورد کار نمی‌کند
- روی دکمه "ایجاد/باز سازی صفحه" کلیک کنید
- مطمئن شوید که افزونه فعال است

### خطای "شماره موبایل نامعتبر"
- شماره موبایل باید با 09 شروع شود
- شماره باید 11 رقم باشد
- مثال صحیح: `09123456789`

## امنیت

این سیستم از روش‌های امنیتی زیر استفاده می‌کند:
- ✅ کدهای OTP یکبار مصرف هستند
- ✅ کدها زمان انقضا دارند
- ✅ رمزهای عبور به صورت تصادفی و قوی ایجاد می‌شوند
- ✅ کاربران نیازی به به خاطر سپردن رمز عبور ندارند
- ✅ ارتباط با API از طریق HTTPS انجام می‌شود

## پشتیبانی

برای کمک بیشتر:
- [مستندات ملی پیامک](https://www.melipayamak.com/documentation/)
- [پشتیبانی ملی پیامک](https://www.melipayamak.com/contact/)

## نمونه پترن‌های مفید

### پترن ساده OTP
```
کد تأیید: %code%
```

### پترن کامل OTP
```
کد تأیید شما: %code%
این کد تا 2 دقیقه اعتبار دارد.
```

### پترن با نام سایت
```
%sitename%
کد ورود شما: %code%
```

توجه: متغیر `%sitename%` باید در پنل ملی پیامک تعریف شده باشد.
