# راهنمای تنظیمات ملی پیامک و داشبورد کاربران

## تغییرات اعمال شده

### 1. اصلاح پیکربندی ملی پیامک

#### مشکل قبلی:
پلاگین به اشتباه برای ارسال پیامک از طریق پترن (الگو)، نیاز به تعیین شماره فرستنده داشت.

#### راه‌حل:
در متد پترن (الگو) ملی پیامک، نیازی به تعیین شماره ارسال‌کننده نیست زیرا شماره فرستنده در تنظیمات الگوی پیامک در پنل ملی پیامک تعریف می‌شود.

#### تنظیمات مورد نیاز:
فقط 3 فیلد زیر الزامی است:
1. **نام کاربری پنل ملی پیامک**
2. **رمز عبور پنل ملی پیامک**
3. **کد پترن (Pattern ID / BodyId)**

### 2. بهبود رابط کاربری تنظیمات

#### بهبودهای اعمال شده:
- طراحی مدرن و حرفه‌ای
- راهنمای بصری با آیکون‌ها
- انیمیشن‌های نرم و روان
- پشتیبانی کامل از موبایل
- نشانگر فیلدهای الزامی
- پیام‌های راهنمای واضح

#### ویژگی‌های جدید UI:
- باکس اطلاعات آبی رنگ برای راهنمایی
- فرم‌های با حاشیه رنگی در حالت فوکوس
- دکمه‌های با افکت شناور
- انیمیشن چرخشی برای حالت بارگذاری
- استایل منوهای داشبورد با قابلیت درگ

### 3. یکپارچه‌سازی با ووکامرس

#### قابلیت‌های اضافه شده:
- نمایش تاریخچه سفارشات
- مدیریت آدرس‌های ارسال و صورتحساب
- نمایش آمار خرید مشتری
- دسترسی به اطلاعات مالی

#### API Endpoints جدید:
```
GET  /wp-json/tabesh/v2/woocommerce/orders
GET  /wp-json/tabesh/v2/woocommerce/addresses
POST /wp-json/tabesh/v2/woocommerce/addresses
GET  /wp-json/tabesh/v2/woocommerce/customer
```

#### جایگزینی صفحه my-account:
- فعال‌سازی از طریق تنظیمات: "جایگزینی ورود ووکامرس با OTP"
- پنهان شدن خودکار منوی پیش‌فرض ووکامرس
- نمایش داشبورد Tabesh به جای صفحه my-account

### 4. مدیریت صفحات داشبورد

#### شناسایی خودکار:
- شناسایی صفحه از طریق URL (مثال: `/panel/`)
- شناسایی صفحه از طریق Page ID
- افزودن کلاس‌های CSS مخصوص به بدنه صفحه

#### ویژگی‌های صفحه:
- نمایش خودکار فرم ورود برای کاربران میهمان
- بارگذاری داشبورد برای کاربران وارد شده
- پشتیبانی کامل از RTL

### 5. فرم ورود/ثبت‌نام با OTP

#### مراحل ورود:
1. **مرحله 1**: ورود شماره موبایل
   - اعتبارسنجی فرمت شماره (09xxxxxxxxx)
   - ارسال کد تأیید از طریق پترن ملی پیامک
   
2. **مرحله 2**: ورود کد تأیید
   - تأیید کد 5 رقمی
   - ورود خودکار برای کاربران موجود
   - درخواست اطلاعات برای کاربران جدید

3. **مرحله 3** (فقط برای کاربران جدید):
   - نام و نام خانوادگی
   - امکان ثبت‌نام به عنوان شخص حقوقی
   - نام سازمان (در صورت انتخاب شخص حقوقی)

#### ویژگی‌های امنیتی:
- انقضای کد پس از 120 ثانیه
- حذف خودکار کدهای استفاده شده
- محافظت در برابر حملات brute force
- رمزهای قوی تصادفی برای کاربران

## راهنمای تنظیمات گام به گام

### تنظیم ملی پیامک:

1. به **Tabesh v2 > Settings > داشبورد کاربران** بروید
2. بخش **تنظیمات ملی پیامک** را پیدا کنید
3. فیلدهای زیر را پر کنید:
   - نام کاربری: نام کاربری پنل خود
   - رمز عبور: رمز عبور پنل خود
   - کد پترن: BodyId الگوی پیامک خود
4. روی **ارسال پیامک آزمایشی** کلیک کنید
5. اگر پیامک دریافت شد، تنظیمات صحیح است

### تنظیم داشبورد:

1. گزینه **فعال‌سازی داشبورد کاربران** را فعال کنید
2. **آدرس صفحه (Slug)** را تعیین کنید (پیش‌فرض: `panel`)
3. روی **ایجاد/باز سازی صفحه** کلیک کنید
4. صفحه داشبورد ایجاد خواهد شد

### فعال‌سازی OTP:

1. گزینه **فعال‌سازی ورود/ثبت‌نام با OTP** را فعال کنید
2. **طول کد OTP** را تنظیم کنید (پیش‌فرض: 5)
3. **زمان انقضا** را تنظیم کنید (پیش‌فرض: 120 ثانیه)
4. سایر گزینه‌ها را به دلخواه تنظیم کنید

### یکپارچه‌سازی ووکامرس:

1. گزینه **جایگزینی ورود ووکامرس با OTP** را فعال کنید
2. این کار باعث می‌شود:
   - صفحه `/my-account/` داشبورد Tabesh را نمایش دهد
   - کاربران با OTP وارد شوند
   - منوی ووکامرس پنهان شود

## شورت‌کدها

### [tabesh_customer_dashboard]
داشبورد پیشرفته مشتری با تمام امکانات

```php
[tabesh_customer_dashboard theme="light"]
```

پارامترها:
- `theme`: تم داشبورد (light یا dark)
- `lang`: زبان (fa یا en)

### [tabesh_user_dashboard]
داشبورد ساده کاربر

```php
[tabesh_user_dashboard]
```

## توجهات مهم

### الزامات سیستم:
- PHP 8.0 یا بالاتر
- WordPress 6.0 یا بالاتر
- WooCommerce 6.0 یا بالاتر (اختیاری)

### امنیت:
- همیشه از نام کاربری و رمز عبور قوی استفاده کنید
- کد پترن خود را محرمانه نگه دارید
- به طور منظم تنظیمات را بررسی کنید

### پشتیبانی:
- در صورت بروز مشکل، ابتدا از **تست اتصال** استفاده کنید
- لاگ‌های خطا را در Console مرورگر بررسی کنید
- از Developer Tools برای دیباگ استفاده کنید

## خطاهای رایج و راه‌حل

### خطا: "شماره فرستنده تنظیم نشده است"
**راه‌حل**: این خطا دیگر نباید رخ دهد. در صورت مشاهده، کش را پاک کنید.

### خطا: "کد پترن یافت نشد"
**راه‌حل**: 
1. مطمئن شوید الگو در پنل ملی پیامک ایجاد شده
2. BodyId را صحیح وارد کرده‌اید
3. الگو تأیید شده است

### خطا: "نام کاربری یا رمز عبور اشتباه است"
**راه‌حل**:
1. نام کاربری و رمز عبور را دوباره وارد کنید
2. مطمئن شوید فضای خالی اضافی وجود ندارد
3. دسترسی API در پنل فعال است

### داشبورد نمایش داده نمی‌شود
**راه‌حل**:
1. مطمئن شوید داشبورد فعال است
2. صفحه را با دکمه "باز سازی" دوباره ایجاد کنید
3. کش مرورگر و پلاگین‌های کش را پاک کنید
4. Permalinks را ذخیره مجدد کنید

## تغییرات فایل‌ها

### فایل‌های اصلاح شده:
```
includes/helpers/class-melipayamak.php
includes/helpers/class-dashboard-integration.php (جدید)
includes/api/class-rest-api.php
includes/core/class-plugin.php
includes/shortcodes/class-customer-dashboard-shortcode.php
assets/css/admin.css
assets/css/dashboard.css
assets/js/dashboard.js
assets/js/src/components/UserDashboardSettings.js
assets/js/src/components/FormComponents.js
```

## نسخه و سازگاری

- نسخه پلاگین: 1.0.0
- سازگار با WordPress: 6.0+
- سازگار با WooCommerce: 6.0+
- سازگار با PHP: 8.0+

---

**تاریخ آخرین به‌روزرسانی**: 2026-01-04

**نگارش**: 1.0.0
