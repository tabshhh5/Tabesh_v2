(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,r=window.wp.i18n,n=window.wp.apiFetch;var s=e.n(n);const l=({length:e=5,value:n="",onChange:s,onComplete:l,disabled:o=!1})=>{const[c,i]=(0,a.useState)(Array(e).fill("")),m=(0,a.useRef)([]),u="0123456789";(0,a.useEffect)(()=>{m.current=m.current.slice(0,e)},[e]),(0,a.useEffect)(()=>{m.current[0]&&!o&&m.current[0].focus()},[o]),(0,a.useEffect)(()=>{if(n){const t=n.split("").slice(0,e),a=[...Array(e)].map((e,a)=>t[a]||"");i(a)}else i(Array(e).fill(""))},[n,e]);const h=e=>e?e.split("").map(e=>{const t="۰۱۲۳۴۵۶۷۸۹".indexOf(e);if(-1!==t)return u[t];const a="٠١٢٣٤٥٦٧٨٩".indexOf(e);return-1!==a?u[a]:e}).join(""):"",d=t=>{t.preventDefault();let a=t.clipboardData.getData("text/plain");a=h(a);const r=a.replace(/\D/g,"").split("").slice(0,e);if(r.length>0){const t=[...Array(e)].map((e,t)=>r[t]||"");i(t);const a=t.join("");s&&s(a);const n=Math.min(r.length-1,e-1);m.current[n]?.focus(),r.length===e&&l&&l(a)}};return(0,t.createElement)("div",{className:"tabesh-otp-container"},c.map((a,n)=>(0,t.createElement)("input",{key:n,ref:e=>m.current[n]=e,type:"text",inputMode:"numeric",autoComplete:0===n?"one-time-code":"off",pattern:"\\d{1}",maxLength:1,className:"tabesh-otp-input",value:a,onChange:t=>((t,a)=>{let r=a.target.value;if(r=h(r),r&&!/^\d$/.test(r))return;const n=[...c];n[t]=r,i(n);const o=n.join("");s&&s(o),r&&t<e-1&&m.current[t+1]?.focus(),r&&t===e-1&&n.every(e=>""!==e)&&l&&l(o)})(n,t),onKeyDown:t=>((t,a)=>{if("Backspace"===a.key){if(a.preventDefault(),c[t]){const e=[...c];e[t]="",i(e),s&&s(e.join(""))}else if(t>0){const e=[...c];e[t-1]="",i(e),m.current[t-1]?.focus(),s&&s(e.join(""))}}else"ArrowLeft"===a.key&&t>0?(a.preventDefault(),m.current[t-1]?.focus()):"ArrowRight"===a.key&&t<e-1&&(a.preventDefault(),m.current[t+1]?.focus())})(n,t),onPaste:d,onFocus:e=>((e,t)=>{t.target.select()})(0,e),disabled:o,"aria-label":(0,r.__)("رقم","tabesh-v2")+" "+(n+1),dir:"ltr"})))},o=()=>{const[e,n]=(0,a.useState)("mobile"),[o,c]=(0,a.useState)(""),[i,m]=(0,a.useState)(""),[u,h]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),[b,v]=(0,a.useState)({text:"",type:""}),[E,f]=(0,a.useState)(""),[g,y]=(0,a.useState)(""),[_,x]=(0,a.useState)(!1),[k,w]=(0,a.useState)(""),N=window.tabeshAuth?.settings||{},L=N.brandTitle||(0,r.__)("ورود به داشبورد","tabesh-v2"),C=N.brandSubtitle||(0,r.__)("سیستم مدیریت چاپ تابش","tabesh-v2"),S=N.logoUrl||"",j=N.otpLength||5,M=(N.requireName,!1!==N.allowCorporate),O=()=>{"register"===e?n("otp"):"otp"===e&&(n("mobile"),m("")),v({text:"",type:""})};return(0,t.createElement)("div",{className:"tabesh-auth-wrapper"},(0,t.createElement)("div",{className:"tabesh-auth-container"},(0,t.createElement)("div",{className:"tabesh-auth-card"},(0,t.createElement)("div",{className:"tabesh-auth-brand"},S?(0,t.createElement)("div",{className:"tabesh-auth-logo custom-logo"},(0,t.createElement)("img",{src:S,alt:L})):(0,t.createElement)("div",{className:"tabesh-auth-logo"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},(0,t.createElement)("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"}))),(0,t.createElement)("h1",null,L),(0,t.createElement)("p",null,C)),"mobile"===e&&(0,t.createElement)("form",{onSubmit:async e=>{if(e.preventDefault(),/^09[0-9]{9}$/.test(o)){p(!0),v({text:"",type:""});try{const e=await s()({path:"/tabesh/v2/auth/check-user",method:"POST",data:{mobile:o}});h(!e.exists);const t=await s()({path:"/tabesh/v2/auth/send-otp",method:"POST",data:{mobile:o}});t.success?(v({text:t.message||(0,r.__)("کد تأیید ارسال شد.","tabesh-v2"),type:"success"}),n("otp")):v({text:t.message,type:"error"})}catch(e){v({text:(0,r.__)("خطا در ارسال کد. لطفاً دوباره تلاش کنید.","tabesh-v2"),type:"error"}),console.error("Error sending OTP:",e)}finally{p(!1)}}else v({text:(0,r.__)("شماره موبایل نامعتبر است.","tabesh-v2"),type:"error"})},className:"tabesh-auth-form fade-in"},(0,t.createElement)("div",{className:"tabesh-form-group"},(0,t.createElement)("label",{htmlFor:"mobile"},(0,r.__)("شماره موبایل","tabesh-v2")),(0,t.createElement)("input",{type:"text",id:"mobile",value:o,onChange:e=>c(e.target.value),placeholder:"09xxxxxxxxx",pattern:"09[0-9]{9}",maxLength:"11",inputMode:"numeric",dir:"ltr",required:!0,disabled:d,className:"tabesh-input"})),(0,t.createElement)("button",{type:"submit",className:"tabesh-btn tabesh-btn-primary",disabled:d},d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("span",{className:"tabesh-spinner-small"}),(0,r.__)("در حال ارسال...","tabesh-v2")):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},(0,t.createElement)("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),(0,r.__)("دریافت کد تأیید","tabesh-v2")))),"otp"===e&&(0,t.createElement)("div",{className:"tabesh-auth-form fade-in"},(0,t.createElement)("div",{className:"tabesh-info-message"},(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},(0,t.createElement)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("polyline",{points:"22 4 12 14.01 9 11.01",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),(0,t.createElement)("p",null,(0,r.__)("کد تأیید به شماره ","tabesh-v2"),(0,t.createElement)("strong",{dir:"ltr"},o),(0,r.__)(" ارسال شد.","tabesh-v2"))),(0,t.createElement)("div",{className:"tabesh-form-group"},(0,t.createElement)("label",null,(0,r.__)("کد تأیید","tabesh-v2")," ",j," ",(0,r.__)("رقمی","tabesh-v2")),(0,t.createElement)(l,{length:j,value:i,onChange:m,onComplete:async e=>{p(!0),v({text:"",type:""});const t={mobile:o,code:e};u&&E&&g&&(t.first_name=E,t.last_name=g,t.is_corporate=_,_&&(t.company_name=k));try{const e=await s()({path:"/tabesh/v2/auth/verify-otp",method:"POST",data:t});if(e.success){if(u&&!E&&!g)return v({text:(0,r.__)("کد تأیید شد. لطفاً اطلاعات خود را تکمیل کنید.","tabesh-v2"),type:"success"}),void n("register");v({text:e.message,type:"success"}),setTimeout(()=>{const e=window.tabeshAuth?.dashboardUrl||"/panel";window.location.href=e},1e3)}else v({text:e.message,type:"error"}),m("")}catch(e){v({text:(0,r.__)("خطا در تأیید کد. لطفاً دوباره تلاش کنید.","tabesh-v2"),type:"error"}),console.error("Error verifying OTP:",e),m("")}finally{p(!1)}},disabled:d}),(0,t.createElement)("p",{className:"tabesh-input-hint"},(0,r.__)("کد به صورت خودکار تأیید می‌شود","tabesh-v2"))),(0,t.createElement)("button",{type:"button",onClick:O,className:"tabesh-btn tabesh-btn-secondary",disabled:d},(0,r.__)("تغییر شماره","tabesh-v2"))),"register"===e&&(0,t.createElement)("form",{onSubmit:async e=>{if(e.preventDefault(),E&&g){p(!0),v({text:"",type:""});try{const e=await s()({path:"/tabesh/v2/auth/verify-otp",method:"POST",data:{mobile:o,code:i,first_name:E,last_name:g,is_corporate:_,company_name:_?k:""}});e.success?(v({text:e.message,type:"success"}),setTimeout(()=>{const e=window.tabeshAuth?.dashboardUrl||"/panel";window.location.href=e},1e3)):v({text:e.message,type:"error"})}catch(e){v({text:(0,r.__)("خطا در ثبت‌نام. لطفاً دوباره تلاش کنید.","tabesh-v2"),type:"error"}),console.error("Error during registration:",e)}finally{p(!1)}}else v({text:(0,r.__)("لطفاً نام و نام خانوادگی را وارد کنید.","tabesh-v2"),type:"error"})},className:"tabesh-auth-form fade-in"},(0,t.createElement)("div",{className:"tabesh-form-group"},(0,t.createElement)("label",{htmlFor:"first-name"},(0,r.__)("نام","tabesh-v2")," ",(0,t.createElement)("span",{className:"required"},"*")),(0,t.createElement)("input",{type:"text",id:"first-name",value:E,onChange:e=>f(e.target.value),required:!0,disabled:d,className:"tabesh-input"})),(0,t.createElement)("div",{className:"tabesh-form-group"},(0,t.createElement)("label",{htmlFor:"last-name"},(0,r.__)("نام خانوادگی","tabesh-v2")," ",(0,t.createElement)("span",{className:"required"},"*")),(0,t.createElement)("input",{type:"text",id:"last-name",value:g,onChange:e=>y(e.target.value),required:!0,disabled:d,className:"tabesh-input"})),M&&(0,t.createElement)("div",{className:"tabesh-form-group"},(0,t.createElement)("label",{className:"tabesh-checkbox-label"},(0,t.createElement)("input",{type:"checkbox",checked:_,onChange:e=>x(e.target.checked),disabled:d}),(0,t.createElement)("span",null,(0,r.__)("شخص حقوقی","tabesh-v2")))),_&&M&&(0,t.createElement)("div",{className:"tabesh-form-group fade-in"},(0,t.createElement)("label",{htmlFor:"company-name"},(0,r.__)("نام سازمان","tabesh-v2")),(0,t.createElement)("input",{type:"text",id:"company-name",value:k,onChange:e=>w(e.target.value),disabled:d,className:"tabesh-input"})),(0,t.createElement)("div",{className:"tabesh-btn-group"},(0,t.createElement)("button",{type:"submit",className:"tabesh-btn tabesh-btn-primary",disabled:d},d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("span",{className:"tabesh-spinner-small"}),(0,r.__)("در حال ثبت...","tabesh-v2")):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},(0,t.createElement)("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),(0,r.__)("تکمیل ثبت‌نام","tabesh-v2"))),(0,t.createElement)("button",{type:"button",onClick:O,className:"tabesh-btn tabesh-btn-secondary",disabled:d},(0,r.__)("بازگشت","tabesh-v2")))),b.text&&(0,t.createElement)("div",{className:`tabesh-auth-message ${b.type}`},"success"===b.type&&(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},(0,t.createElement)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("polyline",{points:"22 4 12 14.01 9 11.01",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),"error"===b.type&&(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},(0,t.createElement)("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("line",{x1:"15",y1:"9",x2:"9",y2:"15",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("line",{x1:"9",y1:"9",x2:"15",y2:"15",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),(0,t.createElement)("p",null,b.text))),(0,t.createElement)("div",{className:"tabesh-auth-footer"},(0,t.createElement)("p",null,(0,r.__)("© 2024 تابش. تمامی حقوق محفوظ است.","tabesh-v2")))))},c=()=>{const e=document.getElementById("tabesh-auth-root");e&&(0,a.render)((0,t.createElement)(o,null),e)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();